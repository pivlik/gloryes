{"version":3,"sources":["app/popup.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","define","magnific","Map","Popup","$link","this","$body","$","$closeBtn","popupOptions","bindEvents","initPopup","value","that","type","data","options","showCloseBtn","fixedContentPos","mainClass","collectMainClass","removalDelay","transitionDelay","callbacks","open","openPopup","require","RangeSlider","each","$slider","removeAttr","setTimeout","close","closePopup","push","undefined","join","magnificPopup","on","hidePopup","window","transitionTime","css","transition-duration","history","pushState","attr","scrollPosition","scrollTop","offset","top","position","popupTargetOpen","$content","document","title","location","pathname","popupTargetClose","append","$popup","parent","clone","$map","find","empty"],"mappings":"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","file":"../../app/popup.js","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\ndefine('app/popup', ['magnific-popup', 'app/map'], function (magnific, Map) {\n    'use strict';\n\n    /**\n     * Попап\n     * @param {Object} $link - jQuery object - ссылка на попапа\n     * @constructor\n     */\n\n    var Popup = function () {\n        function Popup($link) {\n            _classCallCheck(this, Popup);\n\n            this.$link = $link;\n            this.$body = $('body');\n            this.$closeBtn = $('.b-popup__close');\n\n            this.popupOptions();\n            this.bindEvents();\n            this.initPopup();\n        }\n\n        _createClass(Popup, [{\n            key: 'popupOptions',\n            value: function popupOptions() {\n                var that = this;\n                var type = this.$link.data('type');\n\n                this.options = {\n                    type: type || 'inline',\n                    showCloseBtn: false,\n                    fixedContentPos: true,\n                    mainClass: that.collectMainClass(),\n                    removalDelay: that.transitionDelay(),\n                    callbacks: {\n                        open: function open() {\n                            that.openPopup();\n                            that.transitionDelay();\n\n                            //условие для инициализации ion-slider'а в попапе\n                            if (that.$link.data('slider') === 'ion-slider') {\n                                require(['app/range-slider'], function (RangeSlider) {\n                                    $('.j-range-sliders').each(function () {\n                                        var $slider = $(this);\n                                        $slider.removeAttr('data-noinit');\n\n                                        setTimeout(function () {\n                                            return new RangeSlider($slider);\n                                        }, 100);\n                                    });\n                                });\n                            }\n                        },\n                        close: function close() {\n                            that.closePopup();\n                        }\n                    }\n                };\n            }\n        }, {\n            key: 'collectMainClass',\n\n\n            /**\n             *\n             * @returns {string} - строка с модификаторами, которые навешиваются на\n             * родительский блок попапа\n             */\n            value: function collectMainClass() {\n                var mainClass = [];\n\n                if (this.$link.data('theme')) {\n                    mainClass.push('b-popup_theme_' + this.$link.data('theme'));\n                }\n\n                if (this.$link.data('fullsize') !== undefined) {\n                    mainClass.push('b-popup_full_size');\n                }\n\n                if (this.$link.data('toggle-time')) {\n                    mainClass.push('b-popup_theme_toggle');\n                }\n\n                return mainClass.join(' ');\n            }\n        }, {\n            key: 'initPopup',\n\n\n            /**\n             /**\n             * Инициализация попапа, подключение магнифика\n             */\n            value: function initPopup() {\n                this.$link.magnificPopup(this.options);\n            }\n        }, {\n            key: 'bindEvents',\n\n\n            /**\n             * События\n             */\n            value: function bindEvents() {\n                this.$closeBtn.on('click', this.hidePopup);\n                $(window).on('popstate', this.hidePopup);\n            }\n        }, {\n            key: 'transitionDelay',\n\n\n            /**\n             * Добавления transition на попап\n             * @return {Number} - вермя трансофрмации\n             */\n            value: function transitionDelay() {\n                this.transitionTime = this.$link.data('toggle-time');\n\n                if (!this.transitionTime) {\n                    return;\n                }\n\n                $('.mfp-bg, .mfp-wrap').css({\n                    'transition-duration': this.transitionTime + 'ms'\n                });\n\n                return this.transitionTime;\n            }\n        }, {\n            key: 'openPopup',\n\n\n            /**\n             * При открытии попапа\n             */\n            value: function openPopup() {\n                if (!(this.$link.data('type') === 'image' || this.$link.data('type') === 'iframe')) {\n                    window.history.pushState('forward', null, this.$link.attr('href'));\n                }\n\n                this.scrollPosition = $(window).scrollTop() || this.$link.offset().top;\n\n                this.$body.css({\n                    position: 'fixed',\n                    top: -this.scrollPosition\n                });\n\n                this.popupTargetOpen();\n            }\n        }, {\n            key: 'closePopup',\n\n\n            /**\n             * При закрытии попапа\n             */\n            value: function closePopup() {\n                var $content = $('.b-popup__cnt .b-gallery');\n\n                history.pushState('', document.title, window.location.pathname);\n\n                this.$body.css({\n                    position: '',\n                    top: ''\n                });\n\n                $(window).scrollTop(this.scrollPosition);\n\n                this.popupTargetClose();\n\n                //TODO это должна уметь сама галерея\n                $('.b-construction-progress__gallery').append($content);\n            }\n        }, {\n            key: 'hidePopup',\n\n\n            /**\n             * Закрытие попапа\n             */\n            value: function hidePopup() {\n                $.magnificPopup.close();\n            }\n        }, {\n            key: 'showPopup',\n\n\n            /**\n             * Открытие попапа\n             * @param {Object} $popup - jQuery Object - ссылка открывающася попап\n             */\n            value: function showPopup($popup) {\n                $popup.magnificPopup('open');\n            }\n        }, {\n            key: 'popupTargetOpen',\n\n\n            /**\n             * Передайте Коле, чтобы он пофиксил эту хуйню\n             * а ещё передайте, чтобы он следущий раз писал, что ни так\n             * т.к. месяц спустя хз что ни так\n             * @return {Object}  карта\n             */\n            value: function popupTargetOpen() {\n                var target = this.$link.data('target');\n\n                if (target === undefined || target === '') {\n                    return;\n                }\n                var $content = $(target).parent('.b-map__cnt').clone();\n                var $map = $content.find(target).removeAttr('data-noinit');\n                $(this.$link.attr('href')).find('.b-popup__cnt').append($content);\n\n                return new Map($map);\n            }\n        }, {\n            key: 'popupTargetClose',\n            value: function popupTargetClose() {\n                $('#popup-map').find('.b-popup__cnt').empty();\n            }\n        }]);\n\n        return Popup;\n    }();\n\n    return Popup;\n});"]}