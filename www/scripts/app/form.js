"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}();define("app/form",["jquery","polyfiller","app/tpl/form/error","app/tpl/form/success","app/functions","masked-inputs","app/utils"],function(e,t,s,n){return t.setOptions("waitReady",!1),t.setOptions("forms",{lazyCustomMessages:!0,replaceValidationUI:!0,addValidators:!0}),t.setOptions({wspopover:{appendTo:"element"}}),t.polyfill("forms forms-ext"),function(){function t(s,a){_classCallCheck(this,t),this.onSuccess=null,this.onError=null,this.opts={successTpl:n,successText:"Форма успешно отправлена",successHeader:"Заявка отправлена",errorText:"Внутренняя ошибка, пожалуйста, повторите запрос позднее"},e.extend(this.opts,a||{}),this.$el=s instanceof e?s:e(s),this.$cont=this.$el,this.$submit=this.$el.find("[type=submit]")}return _createClass(t,[{key:"init",value:function(){var t=this,s=e('<input type="hidden" name="__s">');s.val(window.__s||""),t.$el.find('[type="tel"]').each(function(){e(this).mask("+7 (999) 999-9999",{autoclear:!1})}),t.$el.append(s).submit(function(e){e.preventDefault(),t.send()})}},{key:"send",value:function(){var t=this;e(":focus").blur(),t.$submit.prop("disabled",!0),e.ajax({url:t.$el.attr("action")||location,data:t.$el.serialize(),type:t.$el.attr("method")||"post",dataType:"json"}).always(function(){t.$submit.prop("disabled",!1)}).done(function(e){var s=e.ret?"handleSuccess":"handleError";t[s](e)}).fail(function(e){t.handleError(e)})}},{key:"handleError",value:function(e){var t=this;if("function"==typeof t.onError){if(t.onError(e))return}t.$cont.swapContent(s({header:"Ошибка",message:e.message||t.opts.errorText}))}},{key:"handleSuccess",value:function(t){var s=this,n=s.opts.successHeader,a=s.opts.successText,r=s.$el.data("header"),o=s.$el.data("message");if(t.redirect)return void(location.href=t.redirect);if("function"==typeof s.onSuccess){if(s.onSuccess(t))return}var i=e.extend({header:r||n,message:o||a},t),c=s.opts.successTpl(i);s.$cont.swapContent(c)}}]),t}()});
//# sourceMappingURL=../sourcemaps/app/form.js.map
