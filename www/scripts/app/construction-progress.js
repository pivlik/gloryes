"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();define("app/construction-progress",["jquery","app/tpl/construction-progress/select","app/tpl/construction-progress/gallery","app/gallery"],function(e,t,r,n){return function(){function a(t){_classCallCheck(this,a),this.$wrapSelects=t.find(".b-construction-progress__select"),this.$selects=t.find("select"),this.$content=t.find(".b-construction-progress__content"),this.$gallery=t.find(".b-construction-progress__gallery"),this.$form=t.find("form"),this.$ajaxLoader=e(".b-ajax-loader"),this.objectId=this.$form.find("input[name=object_id]").val(),this.bindEvents()}return _createClass(a,[{key:"bindEvents",value:function(){this.$selects.on("change",this.send.bind(this))}},{key:"send",value:function(){var t=this;e.ajax({url:this.$form.attr("action"),type:this.$form.attr("method")||"post",data:this.$form.serialize(),dataType:"json",beforeSend:function(){t.$ajaxLoader.show()},success:function(e){t.createSelect(e.selects),t.progressBar(e.progressBar),t.createText(e.text),t.createGallery(e.gallery),t.changeLink(e.selects),t.$ajaxLoader.hide()}})}},{key:"createSelect",value:function(r){var n=this,a=0;this.$wrapSelects.empty(),e.each(r,function(e,r){var s=t(r);n.$wrapSelects.eq(a).append(s);var i=n.$wrapSelects.eq(a).find("select");i.on("change"),i.prop("name",e).on("change",n.send.bind(n)).selectric("init"),a++})}},{key:"createText",value:function(e){this.$content.empty().append(e)}},{key:"createGallery",value:function(e){if(void 0===e)this.$gallery.empty().append("&nbsp;");else{var t=r(e);this.$gallery.empty().append(t),this.initGallery()}}},{key:"progressBar",value:function(t){if(t){var r=e(".b-progress-bar"),n=r.find(".b-progress-bar__base"),a=r.find(".b-progress-bar__done"),s=r.find(".b-progress-bar__current"),i=r.find(".b-progress-bar__text"),o=e(".b-construction-progress__deadline");t.ready_date=t.ready_date||"",t.is_ready?(a.show(),n.hide(),o.hide()):(a.hide(),n.css("display","flex"),o.text(t.ready_date).show(),i.text(t.progress+"%"),s.css("width",t.progress+"%"),t.progress||n.hide())}}},{key:"initGallery",value:function(){return new n(this.$gallery.find(".b-gallery"))}},{key:"changeLink",value:function(t){var r={};e.each(t,function(t,n){e.each(n,function(e,n){!0===n.isSelect&&(r[t]=n.value)})}),r.object_id=this.objectId;var n="?"+decodeURIComponent(e.param(r));window.history.pushState(null,null,n)}}]),a}()});
//# sourceMappingURL=../sourcemaps/app/construction-progress.js.map
