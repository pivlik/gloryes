"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};define("apartments/app",["jquery","./config","./templates","../app/utils","./helpers","./eve","sammy","raphael","scaleraphael","modernizr","videojs","cookie"],function(t,e,o,a,i,n,r,s,l,d,c,u){var f=t("body"),h=function(t){this.$ajaxLoader=t.find(".b-ajax-loader")};h.prototype.showAjaxLoader=function(){this.$ajaxLoader.show()},h.prototype.hideAjaxLoader=function(){this.$ajaxLoader.hide()},h.prototype.getOpacity=function(t){return t=t||{},"flat"===ht.data("view")?t.status?1:.5:gt()&&E||"floor"===ht.data("view")?.3:.5};var v=new h(f),p=require.s.contexts._.config;t.browser={},t.browser.mobile=!1;var m=(t.extend({},e.visualStyles),t(window)),g=t("#substrate"),w=(g.parent(),t(".al-l-mini-filter")),y=t("#back-link"),b=t("#rotate"),k=t("#select-options"),j=t("#floors-list"),P=t("#floor-number-list"),x=t("#floor-number"),L=!1,A=t(e.boxApp),_=!0,S=e.showVideoAnim||!1;"iPhone"===navigator.platform&&(S=!1);var I,O=null,C=null,T=null,E=(t(),0),F=[],z=1,V=0,$=1,N=!1;"iPhone"===navigator.platform&&(S=!1),c.options.flash.swf=p.baseUrl+p.paths.videojs+"/video-js.swf";var B=c("video",{autoplay:!1,preload:"auto",width:"100%",height:"100%"});B.ready(function(){this.on("ended",function(){t("#video").fadeOut(180)})});var U,q=null,D=null,J=window.location.hash.replace("#","")||u("view_side")||"def",R={width:0,height:0},H=.5625,X=function(){},Y=t(),G=!0;e.startPath=window.startPath||e.startPath,function(e){if(e.length){var o=t(".al-l-nav");e.click(function(){o.toggleClass("is-active")})}}(t(".j-al-nav")),e.fullScreen&&(X=function(){if(q){var t=f.width(),e=f.height();e/t>H?g.css({width:e/H,height:e,top:0,left:.5*(t-e/H)}):g.css({width:t,height:t*H,top:.5*(e-t*H),left:0});var o=g.width(),a=g.height();q.changeSize(o,a,!0,!0)}},m.on("resize",X));var K;y.on("click",function(){mt(),v.showAjaxLoader(),I=!0,$=1,N=!0}),A.on("mouseenter mouseleave click",".al-b-pointer",function(o){var a=t(this),i=a.data("href");switch(o.type){case"mouseleave":case"mouseenter":var n=parseInt(a.data("id"),10)||0;if(n<0)return;var r="mouseenter"===o.type?M:Q;T.forEach(function(t){t.data("id")===n&&r(t)});break;case"click":if(!i||!a.data("status"))break;$=1,jt.setLocation(e.homePath+i)}});var M=function(t){t.data("on_filter")&&!O.displayConstantly?n("buildings.highlightFilter_enter",t):O.displayConstantly||n("raphael.event.mouseenter",t)},Q=function(t,e){t.data("on_filter")&&!O.displayConstantly?n("buildings.highlightFilter_leave",t):O.displayConstantly||n("raphael.event.mouseleave",t)},W=function(t){t=t||{};var o=t.colorStart||e.visualStyles.colorStart,a=t.colorEnd||e.visualStyles.colorEnd;if("flat"===ht.data("view")){if(!t.status)return Z(t);t.color&&(o=a=t.color)}return[o,a]},Z=function(t){var o,a;switch(t.rooms){case 0:o="#95bfe7",a="#95bfe7";break;case 1:o="#90c168",a="#90c168";break;case 2:o="#e2bf00",a="#e2bf00";break;case 3:o="#d577b8",a="#b33e8e";break;default:o=e.visualStyles.colorStart,a=e.visualStyles.colorEnd}return[o,a]},tt=function(t){return t=t||{},t.fillOpacity||e.visualStyles.fillOpacity},et=function(t,o){var a=y.parent();return void 0===t?a.toggleAnimated(!1,!1,"fadeOutUp"):(o=o||"Назад","alt"===J&&(t+="#alt"),y.text(o).attr("href",e.homePath+t),void a.toggleAnimated(!0,"fadeInDown"))},ot=function(t,a){if(x.text("этаж "+a),t){var i=o.floors({floors:t,current:a,homePath:e.homePath});P.html(i)}j[t?"show":"hide"]()},at=function(e){return"object"!==(void 0===e?"undefined":_typeof(e))?[]:"object"!==(void 0===e?"undefined":_typeof(e))?[]:t.map(e,function(t){var e=t.pointer;if("object"!==(void 0===e?"undefined":_typeof(e))||"string"!=typeof e.position||!t.id)return null;var o=e.position.split(",");return{id:parseInt(t.id,10)||0,left:o[0]||0,top:o[1]||0,status:t.status,link:t.link,header:e.header,content:e.content}})},it=function(e){return t('.al-b-pointer[data-id="'+e.data("id")+'"]')},nt=function(t,e){t[e?"addClass":"removeClass"]("al-b-pointer_is_hovered")},rt=function(t,e){nt(it(t),e)},st=function(e){var a=e.data("tooltip");K&&K.remove(),a&&""!==a.header&&(K=t("flat"==ht.data("view")?o.tooltipFlat(a):o.tooltip(a)),K.insertAfter(g))},lt=function(t){if(K){var e=t.pageX,o=t.pageY-K.outerHeight()-15;K.css({left:e,top:o}).toggleAnimated(!0,"zoomIn")}},dt=function(){K&&K.hide()},ct=function(o,a){B.one("loadedmetadata",function(){var o=e.speedAnimBetweenView;v.hideAjaxLoader(),B.play(),t("#video").fadeIn(o,a)}).one("error",a),B.src(o)},ut=function(e){var o=[];return t.each(e,function(t,e){e&&o.push({type:"video/"+t,src:e})}),o},ft=function(a,i){var n=(e.startPath,o.content),r={viewName:C.viewName||"",rotateView:C.videoChangePosition&&O.rotateView,pointers:at(C.elements[J]),backText:C.backText,objPath:C.backLink,floors:C.floors||[],isSmooth:G},s=n(r),d=function(o){N=!1,q=l("svg_bottom",R.width,R.height),q.image(C.canvasImg[J],0,0,R.width,R.height),q.setStart();var n=0===C.elements[J].length?"def":J,r=C.elements[n],s=function(t,e){t.animate({fill:"#fff",opacity:1,easing:"easeInOut"},500,function(){t.animate({opacity:t.data("opacity"),easing:"easeOut"},300)})};"flat"===ht.data("view")?(t(".j-logo").removeClass("b-logo_color_white"),t("#back-link").addClass("b-back-link_color_dark")):(t(".j-logo").addClass("b-logo_color_white"),t("#back-link").removeClass("b-back-link_color_dark"));for(var d=0,c=r.length;d<c;d++){var u=r[d],f=v.getOpacity(u),h=W(u),p=tt(u),m=h[0],g=h[1],w=u.link?e.startPath+u.link:null;0!==parseInt(u.count)&&function(){var o=q.path(u.coords);o.attr({stroke:"none",fill:m,"fill-opacity":p,opacity:f,cursor:"pointer"}).data("id",parseInt(u.id,10)||d).data("href",w).data("tooltip",u.tooltip).data("color-end",g).data("color-start",m).data("available",u.available).data("opacity",f).data("toPage",u.toPage||"");var i=function(t){M(this),rt(this,!0),st(this),lt(t)},n=function(){Q(this,E),rt(this,!1),dt()};t.browser.mobile||(o.mouseover(i),o.mouseout(n)),o.click(function(){var o=this;if(!o.data("href"))return!1;if(this.unmouseover(i),this.unmouseout(n),this.unmousemove(lt),dt(),$=1,t.browser.mobile?(M(this),setTimeout(function(){Q(o)},400)):Q(this),this.data("toPage")||a.toPage)window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),document.location=this.data("toPage")?this.data("toPage"):window.location.origin+this.data("href");else{var r=e.homePath+this.data("href");"alt"===J&&(r+="#alt"),document.location.pathname===r?jt.runRoute("get",r):jt.setLocation(r)}}),u.link||o.attr({cursor:"default"}).unclick(),o.mousemove(lt),V&&z&&setTimeout(function(){s(o)},1e3)}()}z=0,T=q.setFinish(),Y=t(".js-floor-switch"),dt(),X(),i&&i.apply()};return"partial"===a.renderType?D.swap(s,d):d()},ht=w.find("form"),vt=ht.find('input[type="checkbox"]'),pt=function(){var t=e.dataLocation,o=ht.serialize();return o&&(t+=t.indexOf("?")>-1?"&":"?",t+=o),t},mt=function(){U&&U.abort()};vt.on("change",function(){var o=pt();E=gt()&&ht.serialize().length,G=!1,v.showAjaxLoader(),mt(),U=t.getJSON(o,ht.data()),U.done(function(t){var o=ht.data("view"),a={};"flat"===o&&(a.toPage=!0),jt.setEnvironment(t,e[o],a)})});var gt=function(){return-1===t.inArray(ht.data("division"),F)},wt=function(){return"flat"!==ht.data("view")},yt=function(t){var e=t.clone().removeAttr("id").addClass("al-l-content_is_active");return e.find(".animated").removeClass("animated"),e},bt=function(){return!!L&&(L=!1,v.hideAjaxLoader(),!0)},kt=function(){L=!0;var t=jt.getLocation();t="alt"===J?t+"#alt":t.replace("#alt",""),jt.setLocation(t)},jt=r(function(){var a=this,i=function(){v.hideAjaxLoader(),G=0,a.swap(o.error({message:"Ой, что-то пошло не так"}))};b.find("a").on("click",function(){mt(),G=!1,v.showAjaxLoader(),$=1,J="alt"===J?"def":"alt",u("view_side",J,{path:"/"});var o=C.videoChangePosition&&C.videoChangePosition[J].mp4&&S;t.loadImage(C.canvasImg[J]).done(function(t,a){if(o)return ct(ut(C.videoChangePosition[J]),function(){q.remove(),R.width=a.width,R.height=a.height,ft({renderType:"partial"})});v.hideAjaxLoader(),R.width=a.width,R.height=a.height;var i=jt.$element(),n=yt(i);i.after(n),ft({renderType:"partial"},function(){return d.cssanimations?void n.animatecss("fadeOut",function(){n.remove()}):void n.fadeOut(e.speedAnimBetweenView,function(){n.remove()})}),kt()}).fail(i)}).on("mouseenter",function(){t(this).animatecss("rotate")}),a.element_selector=e.boxApp,a.notFound=function(t,o){a.setLocation(e.homePath+e.startPath)},a.swap=function(t,e){w.toggleAnimated(gt(),"fadeInUp","fadeOutDown"),et(C.backLink,C.backText),ot(C.floors,C.viewName),b.toggleAnimated(wt(),"fadeInLeft","fadeOutLeft"),z&&k.toggleAnimated(!0,"fadeInRight");var o=function(){a.$element().html(t),e&&e.apply()},i=C.videoFly&&C.videoFly[J].mp4&&!I&&S;return I=!0,i?ct(ut(C.videoFly[J]),o):G?a.smoothTransition(t,e):void o()},a.setEnvironment=function(o,a,n,r){if(n=n||{},C=null,C=o,!C.status)return void i();if(C.toStep){var s=e.homePath+C.toStep;return void jt.setLocation(s)}"alt"===J&&"#alt"!==window.location.hash&&kt(),O=a||{},n.renderType="partial",v.showAjaxLoader(),t.loadImage(C.canvasImg[J]).done(function(t,e){v.hideAjaxLoader(),R.width=e.width,R.height=e.height,ft(n,r)}).fail(i)},a.smoothTransition=function(t,o){var a=jt.$element(),i=yt(a);if(!d.cssanimations)return a.html(t).after(i),"function"==typeof o&&o.apply(this,[t]),void i.fadeOut(e.speedAnimBetweenView,function(){i.remove()});var n=N?"zoomOut":"zoomInFadeOut";i.animatecss(n,function(){i.remove()}),a.html(t).after(i),"function"==typeof o&&o.apply(this,[t])};var n=e.buildings.steps;for(var r in n)!function(o){n.hasOwnProperty(o)&&a.get(""+e.homePath+n[o].urlTemplate+"(#alt)?",function(){if(!bt()){var r=pt(),s=n[o].division,l=n[o].view,d=e.objectId;D=this,G=!0,ht.data("division",s).data("num",D.params[s]||"").data("view",l).data("objectId",d||""),v.showAjaxLoader(),mt(),U=t.getJSON(r,{division:s,num:D.params[s]||"",objectId:d||""},function(t,o,n){switch(s){case"homepage":V=z,a.setEnvironment(t,e.building,{});break;case"building":e.opacity=E?.5:0,e.visualStyles.startOpacity=.7,a.setEnvironment(t,e.section);break;case"section":a.setEnvironment(t,e.floor),_=!1;break;case"floor":if(!t.status)return void i();a.setEnvironment(t,e.flat,{toPage:!0});break;default:V=z,a.setEnvironment(t,e[l],{})}})}})}(r);a.setLocation=function(t,e){return v.showAjaxLoader(),I=void 0===I,this._location_proxy.setLocation(t)}});return jt});
//# sourceMappingURL=../sourcemaps/apartments/app.js.map
